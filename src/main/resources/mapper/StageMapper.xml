<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.team.gyemoim.mapper.StageMapper">
<!--(유진)리스트 띄우기  -->
    <select id="getPFList" resultType="com.team.gyemoim.dto.stage.StageListDTO">
        SELECT * FROM PF
        JOIN ROLL
            ON PF.PFID = ROLL.PFID
--         WHERE STARTFLAG ='대기중'
--         SELECT * FROM PF
--         WHERE STARTFLAG ='N'
    </select>

<!--(유진)deposit에 따라 값 달리 가져오기.-->
    <select id="filterList" resultType="com.team.gyemoim.dto.stage.StageListDTO">
    SELECT * FROM PF
    JOIN ROLL
    ON PF.PFID = ROLL.PFID
    WHERE DEPOSIT IN #{deposit}
--     AND STARTFLAG ='대기중'
    </select>

<!--(유진) 수령순서 가져오기  -->
    <select id="getRecTurn" resultType="com.team.gyemoim.vo.PFVO">
        SELECT RECEIVETURN,pfID
        FROM PARTICIPATION
    </select>
  
    <!--(현지) <스테이지 생성> _스테이지 생성(PF)-->
    <insert id="stageCreate" >
        INSERT  INTO PF(pfID,pfName,pfEntry,pfRate,deposit,interest,receiveTurn,pRank)
        VALUES(PFID_PF_SEQ.NEXTVAL,#{pfName},#{pfEntry},#{pfRate},#{deposit},#{interest},#{receiveTurn},#{pRank})
    </insert>

    <!--(현지) <스테이지 생성> _참가 데이터 -->
    <insert id="stageParticipate" >
        INSERT  INTO Roll2(pfID,receiveTurn,pfMaster)
        VALUES(PFID_PF_SEQ.CURRVAL,#{receiveTurn},'M')
    </insert>

    <!--(현지) <스테이지 생성> _중복체크 -->
    <select id="checkPfName" parameterType="java.util.HashMap" resultType="java.lang.Integer">
        SELECT COUNT(*) FROM pf
        WHERE pfName=#{pfName}
    </select>

    <!--(현지) <스테이지 생성> _수령예정표-->
    <select id="importGet" parameterType="java.util.HashMap" resultType="com.team.gyemoim.dto.stage.ImportDTO">
        SELECT * FROM import2
        WHERE pfRate=#{pfRate}
    </select>

    <!--(현지) <스테이지 생성> _스테이지 pfID 가져오기-->
    <select id="stagePartIn1" parameterType="java.util.HashMap" resultType="com.team.gyemoim.dto.stage.StageCreateDTO">
        SELECT pfID
        FROM PF
        WHERE pfName=#{pfName}
    </select>

    <!--(현지) <스테이지 생성> _스테이지 정보 가져오기-->
    <select id="stagePartIn2" parameterType="java.util.HashMap" resultType="com.team.gyemoim.dto.stage.ImportDTO">
        SELECT uPayment,uTotalReceipts,uRate,uTotalPayment
        FROM import2 i, PF p
        WHERE pfName=#{pfName}
        AND i.pfEntry = p.pfEntry
        AND i.pfRate = p.pfRate
        AND i.deposit= p.deposit
        AND i.receiveTurn= p.receiveTurn
    </select>
</mapper>
